<html>
<head>
<title>JadeWxPlot</title>
<script src="https://cdn.plot.ly/plotly-1.2.0.min.js"></script>
<script language="javascript">
var xhr;
function get_5min_data()
{
  xhr=new XMLHttpRequest();
  xhr.onreadystatechange=do_plot;
<?php
  if (!isset($_GET["date"])) {
?>
  xhr.open("GET","/data5min.json");
<?php
  }
  else {
?>
  xhr.open("GET","/get_plot_data.php?date=<?php print $_GET['date']; ?>");
<?php
  }
?>
  xhr.send("");
}
var trace0={
  x: ["18:01","18:06","18:11","18:16","18:21","18:26","18:31","18:36","18:41","18:46","18:51","18:56","19:01","19:06","19:11","19:16","19:21","19:26","19:31","19:36","19:41","19:46","19:51","19:56","20:01","20:06","20:11","20:16","20:21","20:26","20:31","20:36","20:41","20:46","20:51","20:56","21:01","21:06","21:11","21:16","21:21","21:26","21:31","21:36","21:41","21:46","21:51","21:56","22:01","22:06","22:11","22:16","22:21","22:26","22:31","22:36","22:41","22:46","22:51","22:56","23:01","23:06","23:11","23:16","23:21","23:26","23:31","23:36","23:41","23:46","23:51","23:56","00:01","00:06","00:11","00:16","00:21","00:26","00:31","00:36","00:41","00:46","00:51","00:56","01:01","01:06","01:11","01:16","01:21","01:26","01:31","01:36","01:41","01:46","01:51","01:56","02:01","02:06","02:11","02:16","02:21","02:26","02:31","02:36","02:41","02:46","02:51","02:56","03:01","03:06","03:11","03:16","03:21","03:26","03:31","03:36","03:41","03:46","03:51","03:56","04:01","04:06","04:11","04:16","04:21","04:26","04:31","04:36","04:41","04:46","04:51","04:56","05:01","05:06","05:11","05:16","05:21","05:26","05:31","05:36","05:41","05:46","05:51","05:56","06:01","06:06","06:11","06:16","06:21","06:26","06:31","06:36","06:41","06:46","06:51","06:56","07:01","07:06","07:11","07:16","07:21","07:26","07:31","07:36","07:41","07:46","07:51","07:56","08:01","08:06","08:11","08:16","08:21","08:26","08:31","08:36","08:41","08:46","08:51","08:56","09:01","09:06","09:11","09:16","09:21","09:26","09:31","09:36","09:41","09:46","09:51","09:56","10:01","10:06","10:11","10:16","10:21","10:26","10:31","10:36","10:41","10:46","10:51","10:56","11:01","11:06","11:11","11:16","11:21","11:26","11:31","11:36","11:41","11:46","11:51","11:56","12:01","12:06","12:11","12:16","12:21","12:26","12:31","12:36","12:41","12:46","12:51","12:56","13:01","13:06","13:11","13:16","13:21","13:26","13:31","13:36","13:41","13:46","13:51","13:56","14:01","14:06","14:11","14:16","14:21","14:26","14:31","14:36","14:41","14:46","14:51","14:56","15:01","15:06","15:11","15:16","15:21","15:26","15:31","15:36","15:41","15:46","15:51","15:56","16:01","16:06","16:11","16:16","16:21","16:26","16:31","16:36","16:41","16:46","16:51","16:56","17:01","17:06","17:11","17:16","17:21","17:26","17:31","17:36","17:41","17:46","17:51","17:56"],
  type: 'scatter',
  marker: {
    size: 5
  },
  cliponaxis: false
};
var trace1={
  x: ["18:01","18:06","18:11","18:16","18:21","18:26","18:31","18:36","18:41","18:46","18:51","18:56","19:01","19:06","19:11","19:16","19:21","19:26","19:31","19:36","19:41","19:46","19:51","19:56","20:01","20:06","20:11","20:16","20:21","20:26","20:31","20:36","20:41","20:46","20:51","20:56","21:01","21:06","21:11","21:16","21:21","21:26","21:31","21:36","21:41","21:46","21:51","21:56","22:01","22:06","22:11","22:16","22:21","22:26","22:31","22:36","22:41","22:46","22:51","22:56","23:01","23:06","23:11","23:16","23:21","23:26","23:31","23:36","23:41","23:46","23:51","23:56","00:01","00:06","00:11","00:16","00:21","00:26","00:31","00:36","00:41","00:46","00:51","00:56","01:01","01:06","01:11","01:16","01:21","01:26","01:31","01:36","01:41","01:46","01:51","01:56","02:01","02:06","02:11","02:16","02:21","02:26","02:31","02:36","02:41","02:46","02:51","02:56","03:01","03:06","03:11","03:16","03:21","03:26","03:31","03:36","03:41","03:46","03:51","03:56","04:01","04:06","04:11","04:16","04:21","04:26","04:31","04:36","04:41","04:46","04:51","04:56","05:01","05:06","05:11","05:16","05:21","05:26","05:31","05:36","05:41","05:46","05:51","05:56","06:01","06:06","06:11","06:16","06:21","06:26","06:31","06:36","06:41","06:46","06:51","06:56","07:01","07:06","07:11","07:16","07:21","07:26","07:31","07:36","07:41","07:46","07:51","07:56","08:01","08:06","08:11","08:16","08:21","08:26","08:31","08:36","08:41","08:46","08:51","08:56","09:01","09:06","09:11","09:16","09:21","09:26","09:31","09:36","09:41","09:46","09:51","09:56","10:01","10:06","10:11","10:16","10:21","10:26","10:31","10:36","10:41","10:46","10:51","10:56","11:01","11:06","11:11","11:16","11:21","11:26","11:31","11:36","11:41","11:46","11:51","11:56","12:01","12:06","12:11","12:16","12:21","12:26","12:31","12:36","12:41","12:46","12:51","12:56","13:01","13:06","13:11","13:16","13:21","13:26","13:31","13:36","13:41","13:46","13:51","13:56","14:01","14:06","14:11","14:16","14:21","14:26","14:31","14:36","14:41","14:46","14:51","14:56","15:01","15:06","15:11","15:16","15:21","15:26","15:31","15:36","15:41","15:46","15:51","15:56","16:01","16:06","16:11","16:16","16:21","16:26","16:31","16:36","16:41","16:46","16:51","16:56","17:01","17:06","17:11","17:16","17:21","17:26","17:31","17:36","17:41","17:46","17:51","17:56"],
  type: 'scatter',
  marker: {
    size: 5
  },
  cliponaxis: false
};
data=[
  {
    x: ["18:01","18:06","18:11","18:16","18:21","18:26","18:31","18:36","18:41","18:46","18:51","18:56","19:01","19:06","19:11","19:16","19:21","19:26","19:31","19:36","19:41","19:46","19:51","19:56","20:01","20:06","20:11","20:16","20:21","20:26","20:31","20:36","20:41","20:46","20:51","20:56","21:01","21:06","21:11","21:16","21:21","21:26","21:31","21:36","21:41","21:46","21:51","21:56","22:01","22:06","22:11","22:16","22:21","22:26","22:31","22:36","22:41","22:46","22:51","22:56","23:01","23:06","23:11","23:16","23:21","23:26","23:31","23:36","23:41","23:46","23:51","23:56","00:01","00:06","00:11","00:16","00:21","00:26","00:31","00:36","00:41","00:46","00:51","00:56","01:01","01:06","01:11","01:16","01:21","01:26","01:31","01:36","01:41","01:46","01:51","01:56","02:01","02:06","02:11","02:16","02:21","02:26","02:31","02:36","02:41","02:46","02:51","02:56","03:01","03:06","03:11","03:16","03:21","03:26","03:31","03:36","03:41","03:46","03:51","03:56","04:01","04:06","04:11","04:16","04:21","04:26","04:31","04:36","04:41","04:46","04:51","04:56","05:01","05:06","05:11","05:16","05:21","05:26","05:31","05:36","05:41","05:46","05:51","05:56","06:01","06:06","06:11","06:16","06:21","06:26","06:31","06:36","06:41","06:46","06:51","06:56","07:01","07:06","07:11","07:16","07:21","07:26","07:31","07:36","07:41","07:46","07:51","07:56","08:01","08:06","08:11","08:16","08:21","08:26","08:31","08:36","08:41","08:46","08:51","08:56","09:01","09:06","09:11","09:16","09:21","09:26","09:31","09:36","09:41","09:46","09:51","09:56","10:01","10:06","10:11","10:16","10:21","10:26","10:31","10:36","10:41","10:46","10:51","10:56","11:01","11:06","11:11","11:16","11:21","11:26","11:31","11:36","11:41","11:46","11:51","11:56","12:01","12:06","12:11","12:16","12:21","12:26","12:31","12:36","12:41","12:46","12:51","12:56","13:01","13:06","13:11","13:16","13:21","13:26","13:31","13:36","13:41","13:46","13:51","13:56","14:01","14:06","14:11","14:16","14:21","14:26","14:31","14:36","14:41","14:46","14:51","14:56","15:01","15:06","15:11","15:16","15:21","15:26","15:31","15:36","15:41","15:46","15:51","15:56","16:01","16:06","16:11","16:16","16:21","16:26","16:31","16:36","16:41","16:46","16:51","16:56","17:01","17:06","17:11","17:16","17:21","17:26","17:31","17:36","17:41","17:46","17:51","17:56"],
    type: 'scatter',
    marker: {
      size: 5
    },
    cliponaxis: false
  }
];
layout={
  xaxis: {
    tick0: 0,
    dtick: 24,
    range: [-1, 286],
  },
  margin: {
    t: 30
  }
};
layout_rh={
  title: "Relative Humidity",
  xaxis: {
    tick0: 0,
    dtick: 24
  },
  yaxis: {
    rangemode: "tozero",
    tick0: 0,
    dtick: 25,
    range: [0,105]
  },
  margin: {
    t: 30
  }
};
layout_wspd={
  title: "Wind Speed/Gust",
  xaxis: {
    rangemode: "tozero",
    tick0: 0,
    dtick: 24,
    range: [-1,288]
  },
  yaxis: {
    rangemode: "tozero"
  },
  margin: {
    t: 30
  }
};
layout_wdir={
  title: "Wind Direction",
  xaxis: {
    rangemode: "tozero",
    tick0: 0,
    dtick: 24,
    range: [-1,288]
  },
  yaxis: {
    rangemode: "tozero",
    tick0: 0,
    dtick: 90,
    range: [0,365]
  },
  margin: {
    t: 30
  }
};
var default_max_rain=0.25;
layout_rain={
  title: "Daily Rainfall",
  xaxis: {
    tick0: 0,
    dtick: 24
  },
  yaxis: {
    rangemode: "tozero",
    tick0: 0,
    dtick: 0.10,
    range: [0,default_max_rain]
  },
  margin: {
    t: 30
  }
};
function do_plot()
{
  if (xhr.readyState == 4) {
    eval("data5min="+xhr.responseText);
    data[0].y=data5min.temps;
    data[0].mode="lines";
    layout.title="Temperature";
    Plotly.newPlot('temps_plot',data,layout);
    data[0].y=data5min.rhs;
    data[0].mode="lines";
    Plotly.newPlot('rhs_plot',data,layout_rh);
    trace0.y=data5min.wspds;
    trace0.mode="lines";
    trace1.y=data5min.wgusts;
    trace1.mode="markers";
    Plotly.newPlot('wspds_plot',[trace0,trace1],layout_wspd);
    data[0].y=data5min.wdirs;
    data[0].mode="markers";
    Plotly.newPlot('wdirs_plot',data,layout_wdir);
    data[0].y=data5min.pressures;
    data[0].mode="lines";
    layout.title="Pressure";
    layout.yaxis.dtick=null;
    Plotly.newPlot('pressures_plot',data,layout);
    data[0].y=data5min.rain_days;
    data[0].mode="lines";
    var max_rain=0.;
    for (n=0; n < data5min.rain_days.length; ++n) {
	if (data5min.rain_days[n] > max_rain) {
	  max_rain=data5min.rain_days[n];
	}
    }
    if (max_rain == 0.) {
	max_rain=default_max_rain;
    }
    else {
	max_rain=Math.floor((max_rain+default_max_rain)/default_max_rain)*default_max_rain;
    }
    layout_rain.yaxis.range=[0,max_rain];
    Plotly.newPlot('rain_days_plot',data,layout_rain);
  }
}
</script>
</head>
<?php
  if (!isset($_GET["date"])) {
?>
<body onload="get_5min_data(); setInterval('get_5min_data()',300000)">
<?php
  }
  else {
?>
<body onload="get_5min_data()">
<?php
  }
?>
<div id="temps_plot" style="width: 1000px; height: 250px"></div>
<div id="rhs_plot" style="width: 1000px; height: 250px"></div>
<div id="wspds_plot" style="width: 1000px; height: 250px"></div>
<div id="wdirs_plot" style="width: 1000px; height: 250px"></div>
<div id="pressures_plot" style="width: 1000px; height: 250px"></div>
<div id="rain_days_plot" style="width: 1000px; height: 250px"></div>
</body>
</html>
